<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>maph: Maph REST API Documentation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">maph<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-Performance Memory-Mapped Key-Value Database with O(1) Lookups</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/d1d/md_integrations_2rest__api_2_a_p_i.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Maph REST API Documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md13"></a> </p>
<h1><a class="anchor" id="autotoc_md14"></a>
Overview</h1>
<p>The Maph REST API provides HTTP-based access to Maph databases, enabling integration with web applications, microservices, and any HTTP-capable client. The API follows RESTful principles and returns JSON responses.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
Starting the Server</h2>
<div class="fragment"><div class="line"># Start server on default port (8080)</div>
<div class="line">./maph_server data.maph</div>
<div class="line"> </div>
<div class="line"># Start on custom port</div>
<div class="line">./maph_server data.maph --port 3000</div>
<div class="line"> </div>
<div class="line"># Start with specific database</div>
<div class="line">./maph_server /path/to/database.maph --port 8080</div>
<div class="line"> </div>
<div class="line"># Enable CORS for web clients</div>
<div class="line">./maph_server data.maph --cors</div>
<div class="line"> </div>
<div class="line"># Verbose logging</div>
<div class="line">./maph_server data.maph --verbose</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Basic Usage</h2>
<div class="fragment"><div class="line"># Set a value</div>
<div class="line">curl -X PUT http://localhost:8080/api/kv/user:1 \</div>
<div class="line">  -H &quot;Content-Type: application/json&quot; \</div>
<div class="line">  -d &#39;{&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30}&#39;</div>
<div class="line"> </div>
<div class="line"># Get a value</div>
<div class="line">curl http://localhost:8080/api/kv/user:1</div>
<div class="line"> </div>
<div class="line"># Delete a value</div>
<div class="line">curl -X DELETE http://localhost:8080/api/kv/user:1</div>
<div class="line"> </div>
<div class="line"># Get statistics</div>
<div class="line">curl http://localhost:8080/api/stats</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
API Reference</h1>
<h2><a class="anchor" id="autotoc_md19"></a>
Base URL</h2>
<div class="fragment"><div class="line">http://localhost:8080</div>
</div><!-- fragment --><p>All API endpoints are prefixed with <code>/api</code>.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Authentication</h2>
<p>The current version does not require authentication. Future versions will support:</p><ul>
<li>API keys</li>
<li>JWT tokens</li>
<li>Basic authentication</li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
Content Types</h2>
<ul>
<li><b>Request</b>: <code>application/json</code> for body data</li>
<li><b>Response</b>: <code>application/json</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
Common Response Codes</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Code   </th><th class="markdownTableHeadNone">Meaning    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">200   </td><td class="markdownTableBodyNone">Success    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">201   </td><td class="markdownTableBodyNone">Created    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">204   </td><td class="markdownTableBodyNone">No Content (successful delete)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">400   </td><td class="markdownTableBodyNone">Bad Request    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">404   </td><td class="markdownTableBodyNone">Not Found    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">413   </td><td class="markdownTableBodyNone">Payload Too Large    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">500   </td><td class="markdownTableBodyNone">Internal Server Error    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">503   </td><td class="markdownTableBodyNone">Service Unavailable   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md23"></a>
Endpoints</h1>
<h2><a class="anchor" id="autotoc_md24"></a>
Key-Value Operations</h2>
<h3><a class="anchor" id="autotoc_md25"></a>
GET /api/kv/{key}</h3>
<p>Retrieve a value by key.</p>
<p><b>Parameters:</b></p><ul>
<li><code>key</code> (path) - The key to retrieve</li>
</ul>
<p><b>Response:</b></p><ul>
<li>200: Value found</li>
<li>404: Key not found</li>
</ul>
<p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl http://localhost:8080/api/kv/user:123</div>
</div><!-- fragment --><p><b>Example Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;key&quot;: &quot;user:123&quot;,</div>
<div class="line">  &quot;value&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;Alice&quot;,</div>
<div class="line">    &quot;email&quot;: &quot;alice@example.com&quot;,</div>
<div class="line">    &quot;created&quot;: &quot;2024-01-15T10:30:00Z&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;size&quot;: 89,</div>
<div class="line">  &quot;hash&quot;: &quot;0x1a2b3c4d&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md26"></a>
PUT /api/kv/{key}</h3>
<p>Store or update a value.</p>
<p><b>Parameters:</b></p><ul>
<li><code>key</code> (path) - The key to store</li>
<li>Body - JSON value to store</li>
</ul>
<p><b>Response:</b></p><ul>
<li>201: Created (new key)</li>
<li>200: Updated (existing key)</li>
<li>413: Value too large (&gt;496 bytes)</li>
<li>503: Database full</li>
</ul>
<p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -X PUT http://localhost:8080/api/kv/config:app \</div>
<div class="line">  -H &quot;Content-Type: application/json&quot; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;version&quot;: &quot;1.2.3&quot;,</div>
<div class="line">    &quot;features&quot;: [&quot;auth&quot;, &quot;cache&quot;],</div>
<div class="line">    &quot;timeout&quot;: 30</div>
<div class="line">  }&#39;</div>
</div><!-- fragment --><p><b>Example Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;created&quot;,</div>
<div class="line">  &quot;key&quot;: &quot;config:app&quot;,</div>
<div class="line">  &quot;size&quot;: 67</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md27"></a>
DELETE /api/kv/{key}</h3>
<p>Remove a key-value pair.</p>
<p><b>Parameters:</b></p><ul>
<li><code>key</code> (path) - The key to delete</li>
</ul>
<p><b>Response:</b></p><ul>
<li>204: Successfully deleted</li>
<li>404: Key not found</li>
</ul>
<p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -X DELETE http://localhost:8080/api/kv/temp:session</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md28"></a>
HEAD /api/kv/{key}</h3>
<p>Check if a key exists without retrieving the value.</p>
<p><b>Parameters:</b></p><ul>
<li><code>key</code> (path) - The key to check</li>
</ul>
<p><b>Response Headers:</b></p><ul>
<li><code>X-Exists</code>: "true" or "false"</li>
<li><code>X-Size</code>: Size in bytes (if exists)</li>
</ul>
<p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -I http://localhost:8080/api/kv/user:123</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
Batch Operations</h2>
<h3><a class="anchor" id="autotoc_md30"></a>
POST /api/batch/get</h3>
<p>Retrieve multiple keys in one request.</p>
<p><b>Request Body:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;keys&quot;: [&quot;key1&quot;, &quot;key2&quot;, &quot;key3&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;results&quot;: {</div>
<div class="line">    &quot;key1&quot;: {</div>
<div class="line">      &quot;found&quot;: true,</div>
<div class="line">      &quot;value&quot;: {&quot;data&quot;: &quot;value1&quot;}</div>
<div class="line">    },</div>
<div class="line">    &quot;key2&quot;: {</div>
<div class="line">      &quot;found&quot;: false</div>
<div class="line">    },</div>
<div class="line">    &quot;key3&quot;: {</div>
<div class="line">      &quot;found&quot;: true,</div>
<div class="line">      &quot;value&quot;: {&quot;data&quot;: &quot;value3&quot;}</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;found&quot;: 2,</div>
<div class="line">  &quot;missing&quot;: 1</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -X POST http://localhost:8080/api/batch/get \</div>
<div class="line">  -H &quot;Content-Type: application/json&quot; \</div>
<div class="line">  -d &#39;{&quot;keys&quot;: [&quot;user:1&quot;, &quot;user:2&quot;, &quot;user:3&quot;]}&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31"></a>
POST /api/batch/set</h3>
<p>Store multiple key-value pairs.</p>
<p><b>Request Body:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;operations&quot;: [</div>
<div class="line">    {&quot;key&quot;: &quot;key1&quot;, &quot;value&quot;: {&quot;data&quot;: &quot;value1&quot;}},</div>
<div class="line">    {&quot;key&quot;: &quot;key2&quot;, &quot;value&quot;: {&quot;data&quot;: &quot;value2&quot;}}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;stored&quot;: 2,</div>
<div class="line">  &quot;failed&quot;: 0,</div>
<div class="line">  &quot;results&quot;: [</div>
<div class="line">    {&quot;key&quot;: &quot;key1&quot;, &quot;status&quot;: &quot;created&quot;},</div>
<div class="line">    {&quot;key&quot;: &quot;key2&quot;, &quot;status&quot;: &quot;updated&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -X POST http://localhost:8080/api/batch/set \</div>
<div class="line">  -H &quot;Content-Type: application/json&quot; \</div>
<div class="line">  -d &#39;{</div>
<div class="line">    &quot;operations&quot;: [</div>
<div class="line">      {&quot;key&quot;: &quot;product:1&quot;, &quot;value&quot;: {&quot;name&quot;: &quot;Widget&quot;, &quot;price&quot;: 29.99}},</div>
<div class="line">      {&quot;key&quot;: &quot;product:2&quot;, &quot;value&quot;: {&quot;name&quot;: &quot;Gadget&quot;, &quot;price&quot;: 49.99}}</div>
<div class="line">    ]</div>
<div class="line">  }&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md32"></a>
POST /api/batch/delete</h3>
<p>Delete multiple keys.</p>
<p><b>Request Body:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;keys&quot;: [&quot;key1&quot;, &quot;key2&quot;, &quot;key3&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;deleted&quot;: 2,</div>
<div class="line">  &quot;not_found&quot;: 1,</div>
<div class="line">  &quot;results&quot;: {</div>
<div class="line">    &quot;key1&quot;: &quot;deleted&quot;,</div>
<div class="line">    &quot;key2&quot;: &quot;deleted&quot;,</div>
<div class="line">    &quot;key3&quot;: &quot;not_found&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
Query Operations</h2>
<h3><a class="anchor" id="autotoc_md34"></a>
GET /api/scan</h3>
<p>Scan all keys in the database.</p>
<p><b>Query Parameters:</b></p><ul>
<li><code>limit</code> (optional) - Maximum number of results (default: 100, max: 10000)</li>
<li><code>offset</code> (optional) - Starting position (default: 0)</li>
<li><code>prefix</code> (optional) - Filter by key prefix</li>
</ul>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;keys&quot;: [</div>
<div class="line">    {&quot;key&quot;: &quot;user:1&quot;, &quot;size&quot;: 45, &quot;hash&quot;: &quot;0x1234&quot;},</div>
<div class="line">    {&quot;key&quot;: &quot;user:2&quot;, &quot;size&quot;: 67, &quot;hash&quot;: &quot;0x5678&quot;}</div>
<div class="line">  ],</div>
<div class="line">  &quot;total&quot;: 2,</div>
<div class="line">  &quot;limit&quot;: 100,</div>
<div class="line">  &quot;offset&quot;: 0,</div>
<div class="line">  &quot;has_more&quot;: false</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example Request:</b> </p><div class="fragment"><div class="line"># Get first 50 keys</div>
<div class="line">curl &quot;http://localhost:8080/api/scan?limit=50&quot;</div>
<div class="line"> </div>
<div class="line"># Get keys with prefix</div>
<div class="line">curl &quot;http://localhost:8080/api/scan?prefix=user:&quot;</div>
<div class="line"> </div>
<div class="line"># Paginate through results</div>
<div class="line">curl &quot;http://localhost:8080/api/scan?limit=100&amp;offset=200&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md35"></a>
POST /api/search</h3>
<p>Search for values matching criteria (requires scanning).</p>
<p><b>Request Body:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;field&quot;: &quot;name&quot;,</div>
<div class="line">  &quot;operator&quot;: &quot;contains&quot;,</div>
<div class="line">  &quot;value&quot;: &quot;Alice&quot;,</div>
<div class="line">  &quot;limit&quot;: 10</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;matches&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;key&quot;: &quot;user:1&quot;,</div>
<div class="line">      &quot;value&quot;: {&quot;name&quot;: &quot;Alice Smith&quot;, &quot;age&quot;: 30}</div>
<div class="line">    }</div>
<div class="line">  ],</div>
<div class="line">  &quot;scanned&quot;: 1000,</div>
<div class="line">  &quot;matched&quot;: 1</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Note:</b> This operation scans all values and can be slow for large databases.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Database Operations</h2>
<h3><a class="anchor" id="autotoc_md37"></a>
GET /api/stats</h3>
<p>Get database statistics.</p>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;database&quot;: {</div>
<div class="line">    &quot;path&quot;: &quot;/var/lib/maph/data.maph&quot;,</div>
<div class="line">    &quot;size_bytes&quot;: 512512000,</div>
<div class="line">    &quot;size_mb&quot;: 488.77</div>
<div class="line">  },</div>
<div class="line">  &quot;slots&quot;: {</div>
<div class="line">    &quot;total&quot;: 1000000,</div>
<div class="line">    &quot;used&quot;: 42531,</div>
<div class="line">    &quot;free&quot;: 957469,</div>
<div class="line">    &quot;static&quot;: 800000,</div>
<div class="line">    &quot;dynamic&quot;: 200000</div>
<div class="line">  },</div>
<div class="line">  &quot;performance&quot;: {</div>
<div class="line">    &quot;load_factor&quot;: 0.0425,</div>
<div class="line">    &quot;generation&quot;: 85062,</div>
<div class="line">    &quot;avg_lookup_ns&quot;: 198,</div>
<div class="line">    &quot;avg_insert_ns&quot;: 452</div>
<div class="line">  },</div>
<div class="line">  &quot;server&quot;: {</div>
<div class="line">    &quot;uptime_seconds&quot;: 3600,</div>
<div class="line">    &quot;total_requests&quot;: 1234567,</div>
<div class="line">    &quot;active_connections&quot;: 42,</div>
<div class="line">    &quot;memory_usage_mb&quot;: 512.3</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md38"></a>
POST /api/compact</h3>
<p>Trigger database compaction (reorganize for better performance).</p>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;completed&quot;,</div>
<div class="line">  &quot;before&quot;: {</div>
<div class="line">    &quot;fragmentation&quot;: 0.15,</div>
<div class="line">    &quot;load_factor&quot;: 0.75</div>
<div class="line">  },</div>
<div class="line">  &quot;after&quot;: {</div>
<div class="line">    &quot;fragmentation&quot;: 0.02,</div>
<div class="line">    &quot;load_factor&quot;: 0.65</div>
<div class="line">  },</div>
<div class="line">  &quot;duration_ms&quot;: 1234</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md39"></a>
POST /api/sync</h3>
<p>Force synchronization to disk.</p>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;synced&quot;,</div>
<div class="line">  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md40"></a>
GET /api/info</h3>
<p>Get server information.</p>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</div>
<div class="line">  &quot;database&quot;: &quot;data.maph&quot;,</div>
<div class="line">  &quot;features&quot;: [&quot;batch&quot;, &quot;scan&quot;, &quot;stats&quot;],</div>
<div class="line">  &quot;limits&quot;: {</div>
<div class="line">    &quot;max_value_size&quot;: 496,</div>
<div class="line">    &quot;max_batch_size&quot;: 1000,</div>
<div class="line">    &quot;max_scan_limit&quot;: 10000</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Import/Export</h2>
<h3><a class="anchor" id="autotoc_md42"></a>
POST /api/import</h3>
<p>Import data from JSONL format.</p>
<p><b>Request Body (multipart/form-data):</b></p><ul>
<li><code>file</code> - JSONL file to import</li>
<li><code>mode</code> - "overwrite" or "merge" (default: "merge")</li>
</ul>
<p><b>Response:</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;imported&quot;: 10000,</div>
<div class="line">  &quot;failed&quot;: 2,</div>
<div class="line">  &quot;duration_ms&quot;: 234,</div>
<div class="line">  &quot;errors&quot;: [</div>
<div class="line">    {&quot;line&quot;: 456, &quot;error&quot;: &quot;value too large&quot;},</div>
<div class="line">    {&quot;line&quot;: 789, &quot;error&quot;: &quot;invalid JSON&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example Request:</b> </p><div class="fragment"><div class="line">curl -X POST http://localhost:8080/api/import \</div>
<div class="line">  -F &quot;file=@data.jsonl&quot; \</div>
<div class="line">  -F &quot;mode=merge&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md43"></a>
GET /api/export</h3>
<p>Export database to JSONL format.</p>
<p><b>Query Parameters:</b></p><ul>
<li><code>prefix</code> (optional) - Export only keys with this prefix</li>
</ul>
<p><b>Response:</b> Streams JSONL data with one key-value pair per line.</p>
<p><b>Example Request:</b> </p><div class="fragment"><div class="line"># Export entire database</div>
<div class="line">curl http://localhost:8080/api/export &gt; backup.jsonl</div>
<div class="line"> </div>
<div class="line"># Export specific prefix</div>
<div class="line">curl &quot;http://localhost:8080/api/export?prefix=user:&quot; &gt; users.jsonl</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md44"></a>
Web Interface</h1>
<p>The server includes a built-in web interface accessible at:</p>
<div class="fragment"><div class="line">http://localhost:8080/</div>
</div><!-- fragment --><p>Features:</p><ul>
<li>Visual key-value browser</li>
<li>Statistics dashboard</li>
<li>Query builder</li>
<li>Import/export tools</li>
<li>Real-time performance metrics</li>
</ul>
<h1><a class="anchor" id="autotoc_md45"></a>
WebSocket API</h1>
<p>Connect to real-time updates via WebSocket:</p>
<div class="fragment"><div class="line">const ws = new WebSocket(&#39;ws://localhost:8080/ws&#39;);</div>
<div class="line"> </div>
<div class="line">// Subscribe to changes</div>
<div class="line">ws.send(JSON.stringify({</div>
<div class="line">  action: &#39;subscribe&#39;,</div>
<div class="line">  prefix: &#39;user:&#39;</div>
<div class="line">}));</div>
<div class="line"> </div>
<div class="line">// Receive updates</div>
<div class="line">ws.onmessage = (event) =&gt; {</div>
<div class="line">  const data = JSON.parse(event.data);</div>
<div class="line">  console.log(&#39;Change:&#39;, data);</div>
<div class="line">  // {type: &#39;set&#39;, key: &#39;user:123&#39;, value: {...}}</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md46"></a>
Client Libraries</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
JavaScript/Node.js</h2>
<div class="fragment"><div class="line">const MaphClient = require(&#39;maph-client&#39;);</div>
<div class="line"> </div>
<div class="line">const client = new MaphClient({</div>
<div class="line">  host: &#39;localhost&#39;,</div>
<div class="line">  port: 8080</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Set value</div>
<div class="line">await client.set(&#39;user:1&#39;, {name: &#39;Alice&#39;});</div>
<div class="line"> </div>
<div class="line">// Get value</div>
<div class="line">const value = await client.get(&#39;user:1&#39;);</div>
<div class="line"> </div>
<div class="line">// Batch operations</div>
<div class="line">const results = await client.mget([&#39;user:1&#39;, &#39;user:2&#39;]);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Python</h2>
<div class="fragment"><div class="line"><span class="keyword">from</span> maph_client <span class="keyword">import</span> MaphClient</div>
<div class="line"> </div>
<div class="line">client = MaphClient(host=<span class="stringliteral">&#39;localhost&#39;</span>, port=8080)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set value</span></div>
<div class="line">client.set(<span class="stringliteral">&#39;user:1&#39;</span>, {<span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Alice&#39;</span>})</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get value</span></div>
<div class="line">value = client.get(<span class="stringliteral">&#39;user:1&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Batch operations</span></div>
<div class="line">results = client.mget([<span class="stringliteral">&#39;user:1&#39;</span>, <span class="stringliteral">&#39;user:2&#39;</span>])</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
Go</h2>
<div class="fragment"><div class="line">import &quot;github.com/maph/maph-go&quot;</div>
<div class="line"> </div>
<div class="line">client := maph.NewClient(&quot;localhost:8080&quot;)</div>
<div class="line"> </div>
<div class="line">// Set value</div>
<div class="line">client.Set(&quot;user:1&quot;, map[string]interface{}{</div>
<div class="line">    &quot;name&quot;: &quot;Alice&quot;,</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// Get value</div>
<div class="line">value, err := client.Get(&quot;user:1&quot;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md50"></a>
Performance Considerations</h1>
<h2><a class="anchor" id="autotoc_md51"></a>
Connection Pooling</h2>
<p>The server supports HTTP keep-alive. Reuse connections for better performance:</p>
<div class="fragment"><div class="line">curl -H &quot;Connection: keep-alive&quot; http://localhost:8080/api/kv/key</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
Batch vs Individual Operations</h2>
<p>For multiple operations, use batch endpoints:</p>
<div class="fragment"><div class="line">Individual: 1000 requests × 1ms = 1000ms</div>
<div class="line">Batch: 1 request × 10ms = 10ms</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
Compression</h2>
<p>The server supports gzip compression:</p>
<div class="fragment"><div class="line">curl -H &quot;Accept-Encoding: gzip&quot; http://localhost:8080/api/stats</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md54"></a>
Rate Limiting</h2>
<p>Default limits (configurable):</p><ul>
<li>10,000 requests/second per IP</li>
<li>1,000 concurrent connections</li>
<li>10MB max request body</li>
</ul>
<h1><a class="anchor" id="autotoc_md55"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md56"></a>
Error Response Format</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;error&quot;: {</div>
<div class="line">    &quot;code&quot;: &quot;VALUE_TOO_LARGE&quot;,</div>
<div class="line">    &quot;message&quot;: &quot;Value exceeds maximum size of 496 bytes&quot;,</div>
<div class="line">    &quot;details&quot;: {</div>
<div class="line">      &quot;provided_size&quot;: 512,</div>
<div class="line">      &quot;max_size&quot;: 496</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md57"></a>
Error Codes</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Code   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">KEY_NOT_FOUND   </td><td class="markdownTableBodyNone">Key does not exist    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VALUE_TOO_LARGE   </td><td class="markdownTableBodyNone">Value exceeds 496 bytes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DATABASE_FULL   </td><td class="markdownTableBodyNone">No space for new keys    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">INVALID_JSON   </td><td class="markdownTableBodyNone">Malformed JSON in request    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BATCH_TOO_LARGE   </td><td class="markdownTableBodyNone">Batch exceeds limit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SCAN_LIMIT_EXCEEDED   </td><td class="markdownTableBodyNone">Scan limit too high    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">INTERNAL_ERROR   </td><td class="markdownTableBodyNone">Server error   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md58"></a>
Security</h1>
<h2><a class="anchor" id="autotoc_md59"></a>
Best Practices</h2>
<ol type="1">
<li><b>Network Security</b>:<ul>
<li>Run behind reverse proxy (nginx, HAProxy)</li>
<li>Use HTTPS in production</li>
<li>Implement firewall rules</li>
</ul>
</li>
<li><b>Access Control</b>:<ul>
<li>Future: API key authentication</li>
<li>Future: Role-based access control</li>
<li>Future: IP whitelisting</li>
</ul>
</li>
<li><b>Input Validation</b>:<ul>
<li>Key length limits</li>
<li>Value size validation</li>
<li>JSON schema validation</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md60"></a>
CORS Configuration</h2>
<div class="fragment"><div class="line"># Enable CORS for specific origin</div>
<div class="line">./maph_server data.maph --cors-origin &quot;https://example.com&quot;</div>
<div class="line"> </div>
<div class="line"># Enable CORS for all origins (development only)</div>
<div class="line">./maph_server data.maph --cors-origin &quot;*&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md61"></a>
Monitoring</h1>
<h2><a class="anchor" id="autotoc_md62"></a>
Health Check</h2>
<div class="fragment"><div class="line">curl http://localhost:8080/api/health</div>
</div><!-- fragment --><p>Response: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;status&quot;: &quot;healthy&quot;,</div>
<div class="line">  &quot;database&quot;: &quot;connected&quot;,</div>
<div class="line">  &quot;memory&quot;: &quot;ok&quot;,</div>
<div class="line">  &quot;disk&quot;: &quot;ok&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md63"></a>
Metrics Endpoint</h2>
<div class="fragment"><div class="line">curl http://localhost:8080/metrics</div>
</div><!-- fragment --><p>Returns Prometheus-compatible metrics:</p>
<div class="fragment"><div class="line"># HELP maph_requests_total Total number of requests</div>
<div class="line"># TYPE maph_requests_total counter</div>
<div class="line">maph_requests_total{method=&quot;GET&quot;} 12345</div>
<div class="line"> </div>
<div class="line"># HELP maph_response_time_seconds Response time in seconds</div>
<div class="line"># TYPE maph_response_time_seconds histogram</div>
<div class="line">maph_response_time_seconds_bucket{le=&quot;0.001&quot;} 10000</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md64"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md65"></a>
Environment Variables</h2>
<div class="fragment"><div class="line">MAPH_PORT=8080                 # Server port</div>
<div class="line">MAPH_HOST=0.0.0.0             # Bind address</div>
<div class="line">MAPH_MAX_CONNECTIONS=1000      # Max concurrent connections</div>
<div class="line">MAPH_REQUEST_TIMEOUT=30        # Request timeout in seconds</div>
<div class="line">MAPH_CORS_ENABLED=true         # Enable CORS</div>
<div class="line">MAPH_GZIP_ENABLED=true         # Enable compression</div>
<div class="line">MAPH_LOG_LEVEL=info           # Log level (debug|info|warn|error)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md66"></a>
Configuration File</h2>
<div class="fragment"><div class="line"># maph_server.yaml</div>
<div class="line">server:</div>
<div class="line">  port: 8080</div>
<div class="line">  host: 0.0.0.0</div>
<div class="line">  max_connections: 1000</div>
<div class="line"> </div>
<div class="line">database:</div>
<div class="line">  path: /var/lib/maph/data.maph</div>
<div class="line">  sync_interval: 60  # seconds</div>
<div class="line">  </div>
<div class="line">security:</div>
<div class="line">  cors_enabled: true</div>
<div class="line">  cors_origins:</div>
<div class="line">    - https://app.example.com</div>
<div class="line">  rate_limit:</div>
<div class="line">    requests_per_second: 10000</div>
<div class="line">    </div>
<div class="line">logging:</div>
<div class="line">  level: info</div>
<div class="line">  file: /var/log/maph/server.log</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md67"></a>
Docker Deployment</h1>
<h2><a class="anchor" id="autotoc_md68"></a>
Dockerfile</h2>
<div class="fragment"><div class="line">FROM ubuntu:22.04</div>
<div class="line">RUN apt-get update &amp;&amp; apt-get install -y build-essential cmake</div>
<div class="line">COPY . /app</div>
<div class="line">WORKDIR /app</div>
<div class="line">RUN mkdir build &amp;&amp; cd build &amp;&amp; cmake .. &amp;&amp; make maph_server</div>
<div class="line">RUN cp build/maph_server /usr/local/bin/</div>
<div class="line"> </div>
<div class="line">EXPOSE 8080</div>
<div class="line">VOLUME [<span class="stringliteral">&quot;/data&quot;</span>]</div>
<div class="line">CMD [<span class="stringliteral">&quot;maph_server&quot;</span>, <span class="stringliteral">&quot;/data/database.maph&quot;</span>]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
Docker Compose</h2>
<div class="fragment"><div class="line">version: &#39;3&#39;</div>
<div class="line">services:</div>
<div class="line">  maph:</div>
<div class="line">    build: .</div>
<div class="line">    ports:</div>
<div class="line">      - &quot;8080:8080&quot;</div>
<div class="line">    volumes:</div>
<div class="line">      - maph_data:/data</div>
<div class="line">    environment:</div>
<div class="line">      - MAPH_PORT=8080</div>
<div class="line">      - MAPH_LOG_LEVEL=info</div>
<div class="line">    restart: unless-stopped</div>
<div class="line"> </div>
<div class="line">volumes:</div>
<div class="line">  maph_data:</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
Kubernetes Deployment</h2>
<div class="fragment"><div class="line">apiVersion: apps/v1</div>
<div class="line">kind: Deployment</div>
<div class="line">metadata:</div>
<div class="line">  name: maph-server</div>
<div class="line">spec:</div>
<div class="line">  replicas: 3</div>
<div class="line">  selector:</div>
<div class="line">    matchLabels:</div>
<div class="line">      app: maph</div>
<div class="line">  template:</div>
<div class="line">    metadata:</div>
<div class="line">      labels:</div>
<div class="line">        app: maph</div>
<div class="line">    spec:</div>
<div class="line">      containers:</div>
<div class="line">      - name: maph</div>
<div class="line">        image: maph:latest</div>
<div class="line">        ports:</div>
<div class="line">        - containerPort: 8080</div>
<div class="line">        volumeMounts:</div>
<div class="line">        - name: data</div>
<div class="line">          mountPath: /data</div>
<div class="line">      volumes:</div>
<div class="line">      - name: data</div>
<div class="line">        persistentVolumeClaim:</div>
<div class="line">          claimName: maph-pvc</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md72"></a>
Session Store</h2>
<div class="fragment"><div class="line">// Store session</div>
<div class="line">await fetch(&#39;http://localhost:8080/api/kv/session:abc123&#39;, {</div>
<div class="line">  method: &#39;PUT&#39;,</div>
<div class="line">  headers: {&#39;Content-Type&#39;: &#39;application/json&#39;},</div>
<div class="line">  body: JSON.stringify({</div>
<div class="line">    user_id: 42,</div>
<div class="line">    expires: &#39;2024-01-16T10:00:00Z&#39;,</div>
<div class="line">    data: {cart: [&#39;item1&#39;, &#39;item2&#39;]}</div>
<div class="line">  })</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Get session</div>
<div class="line">const response = await fetch(&#39;http://localhost:8080/api/kv/session:abc123&#39;);</div>
<div class="line">const session = await response.json();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md73"></a>
Cache Layer</h2>
<div class="fragment"><div class="line"><span class="keyword">import</span> requests</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MaphCache:</div>
<div class="line">    <span class="keyword">def </span>__init__(self, host=&#39;localhost:8080<span class="stringliteral">&#39;):</span></div>
<div class="line"><span class="stringliteral">        self.base_url = f&#39;http://{host}/api&#39;</span></div>
<div class="line">    </div>
<div class="line">    <span class="keyword">def </span>get(self, key):</div>
<div class="line">        r = requests.get(f<span class="stringliteral">&#39;{self.base_url}/kv/{key}&#39;</span>)</div>
<div class="line">        <span class="keywordflow">if</span> r.status_code == 200:</div>
<div class="line">            <span class="keywordflow">return</span> r.json()[<span class="stringliteral">&#39;value&#39;</span>]</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line">    </div>
<div class="line">    <span class="keyword">def </span>set(self, key, value, ttl=None):</div>
<div class="line">        <span class="comment"># Note: TTL not natively supported, store expiry in value</span></div>
<div class="line">        <span class="keywordflow">if</span> ttl:</div>
<div class="line">            value[<span class="stringliteral">&#39;_expires&#39;</span>] = time.time() + ttl</div>
<div class="line">        r = requests.put(f<span class="stringliteral">&#39;{self.base_url}/kv/{key}&#39;</span>, json=value)</div>
<div class="line">        <span class="keywordflow">return</span> r.status_code <span class="keywordflow">in</span> (200, 201)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md74"></a>
Real-time Dashboard</h2>
<div class="fragment"><div class="line">&lt;!DOCTYPE html&gt;</div>
<div class="line">&lt;html&gt;</div>
<div class="line">&lt;head&gt;</div>
<div class="line">    &lt;title&gt;Maph Dashboard&lt;/title&gt;</div>
<div class="line">&lt;/head&gt;</div>
<div class="line">&lt;body&gt;</div>
<div class="line">    &lt;div id=&quot;stats&quot;&gt;&lt;/div&gt;</div>
<div class="line">    &lt;script&gt;</div>
<div class="line">        // Poll stats every second</div>
<div class="line">        setInterval(async () =&gt; {</div>
<div class="line">            const res = await fetch(&#39;/api/stats&#39;);</div>
<div class="line">            const stats = await res.json();</div>
<div class="line">            document.getElementById(&#39;stats&#39;).innerHTML = `</div>
<div class="line">                &lt;h2&gt;Database Stats&lt;/h2&gt;</div>
<div class="line">                &lt;p&gt;Used Slots: ${stats.slots.used}&lt;/p&gt;</div>
<div class="line">                &lt;p&gt;Load Factor: ${(stats.performance.load_factor * 100).toFixed(2)}%&lt;/p&gt;</div>
<div class="line">                &lt;p&gt;Requests: ${stats.server.total_requests}&lt;/p&gt;</div>
<div class="line">            `;</div>
<div class="line">        }, 1000);</div>
<div class="line">    &lt;/script&gt;</div>
<div class="line">&lt;/body&gt;</div>
<div class="line">&lt;/html&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md75"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md76"></a>
Connection Refused</h2>
<div class="fragment"><div class="line"># Check if server is running</div>
<div class="line">ps aux | grep maph_server</div>
<div class="line"> </div>
<div class="line"># Check port availability</div>
<div class="line">netstat -tlnp | grep 8080</div>
<div class="line"> </div>
<div class="line"># Check firewall</div>
<div class="line">ufw status</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Slow Performance</h2>
<div class="fragment"><div class="line"># Check database stats</div>
<div class="line">curl http://localhost:8080/api/stats</div>
<div class="line"> </div>
<div class="line"># Monitor server metrics</div>
<div class="line">curl http://localhost:8080/metrics</div>
<div class="line"> </div>
<div class="line"># Enable debug logging</div>
<div class="line">MAPH_LOG_LEVEL=debug ./maph_server data.maph</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
Data Corruption</h2>
<div class="fragment"><div class="line"># Verify database integrity</div>
<div class="line">maph stats data.maph</div>
<div class="line"> </div>
<div class="line"># Create backup</div>
<div class="line">cp data.maph data.maph.backup</div>
<div class="line"> </div>
<div class="line"># Rebuild if necessary</div>
<div class="line">maph export data.maph &gt; backup.jsonl</div>
<div class="line">maph create newdata.maph 1000000</div>
<div class="line">maph import newdata.maph &lt; backup.jsonl</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 4 2025 01:57:37 for maph by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
